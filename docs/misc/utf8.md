## 为什么我的 `nano` / `vim` 显示中文是乱码？

如 [这个 issue](https://git.tsinghua.edu.cn/physics-data/faq/-/issues/546) 中所显示的，部分同学使用 `nano` 等基于终端的编辑器打开含有中文的文件时，屏幕上会显示乱码，在输入中文时同样也会显示乱码。

![issue 中同学的屏幕截图](https://git.tsinghua.edu.cn/-/project/14787/uploads/66c836f2dbaef17a9cd0fd24a842b095/11711750678436_.pic.jpg "nano 中的乱码")

出现乱码通常是编码错误导致的，有可能是终端模拟器不支持 UTF-8 编码，或是编辑器 (`nano`, `vim`) 没有采用 UTF-8 编码，后者往往是最有可能的。

### 怎么让终端模拟器支持 UTF-8 编码？
大多数现代终端都对 UTF-8 有很好的支持。如果你在终端当中见到过中文输出，那么你的终端是一定支持 UTF-8 编码的。如果没有，为了判断终端是否支持，可以运行下面这行代码
```bash
python3 -c "print('\u4f60\u597d')"  # usage: python3 -c <command>
```
正常的输出是：`你好` (前提是你已经装好了 `python3`)。

如果 (没有报错并且) 输出不是 `你好`，说明终端模拟器不支持 UTF-8 编码，解决的办法是 **重新下载一个终端模拟器**。在 Windows 下可以安装 Windows Terminal。

### 怎么让编辑器采用 UTF-8编码？

如果你没有修改过 `nano` 或 `vim` 的配置文件，编辑器在启动时会使用环境变量中获取的编码和语言。此时应当检查 `LANG` 环境变量，运行下面一行代码
```bash
echo $LANG
```
正确的输出应当形如 `en_US.UTF-8` 或 `zh_CN.UTF-8`，而错误的输出可能为空，或形如 `"en_US.UTF-8"` 或 `"zh_CN.UTF-8"`。`LANG` 变量中不应当有额外的引号或其他符号。

以下的两种方法都可以解决。

#### 修改终端的环境变量
解决这一问题最简单的方式是手动设置一下环境变量，在终端中执行
```bash
export LANG=en_US.UTF-8
```
之后在同一终端中打开含有中文的文件就不会出现乱码。

为了使这一修改持久化，我们可以在 shell 软件的配置文件中加上这一行命令，使其在 shell 启动时自动被执行。以 `bash` 为例：
```bash
$ nano ~/.bashrc
# 添加下面这行，保存并退出
export LANG=en_US.UTF-8
```
修改配置文件后，新启动的 `bash` 可以为编辑器正确提供环境变量。

#### 修改系统级别的配置文件
不同发行版其语言和编码配置的文件位置有所差异，但大体上都是在 `/etc` 下某个名字包含 `locale` 的文件，这里给出两种可能性。可以分别执行下面两行命令来判断系统中是否有这个配置文件，以及查看这个文件当中的配置是否是 UTF-8 编码。
```bash
cat /etc/locale.conf
cat /etc/default/locale
```
如果某个配置文件中的配置不是 UTF-8 编码，那么使用 `sudo` 打开编辑器修改其内容为 `LANG=en_US.UTF-8`， 保存并退出。在新建终端中编辑器应当能正确显示中文字符。